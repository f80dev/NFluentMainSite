<div class="mainform" style="position:fixed;width:100vw;height:100vh;background-repeat: no-repeat;background-size: cover;" [style.background-image]="'url('+background_image+')'"><div class="background-component" style="position:absolute;left:3%;top:3%;min-height: 90vh;max-width: 500px;width:90%;display: inline-block;text-align: center;color: white;padding: 10px;z-index: 2;">

	<div class="titleform">{{appname}}</div>
	<div class="subtitleform">{{claim}}</div>

	<div class="background-component"
	     style="min-height: 80vh;max-width: 500px;width:90%;display: inline-block;text-align: center;color: white;position: relative;">

		<app-hourglass anim="./assets/engrenage.gif"
		               [message]="message"
		               style="margin-top: 50px;margin-bottom: 50px;"></app-hourglass>

		<div style="position:relative;display: inline-block;text-align: center;width: 100%;overflow: hidden;" *ngIf="message.length==0 && !show_login">
			<mat-vertical-stepper [linear]="false" style="margin-left:-10px;width:98%;"
			                      [animationDuration]="'100'"
			                      *ngIf="url_wallet.length+url_explorer.length==0">
				<mat-step>
					<ng-template matStepLabel>Charger un ou plusieurs documents</ng-template>

					<div *ngIf="!show_scanner" style="display: flex;margin-left:-20px;">

						<app-upload-file (uploaded)="onFileSelected($event)" [zone]="true" width="120px" height="38px"
						                 title="Importer un document depuis votre ordinateur / smartphone"
						                 [maxsize]="10000000">
							Importer
						</app-upload-file>


						<button mat-raised-button style="margin-top: 0;"
						        title="Prendre en photo / scanner un document"
						        (click)="show_scanner=true">
							Scanner
						</button>

						<button mat-raised-button style="margin-top: 0;"
						        title="Attacher un document via son adresse internet (url)"
						        (click)="attach_document()">
							Attacher
						</button>
					</div>

					<div *ngIf="show_scanner">
						<button mat-raised-button (click)="show_scanner=false">
							Arrêter
						</button>
						<br>
						<app-scanner caption="Pointer vers le document à scanner"
						             [showCapture]="true"
						             (capture)="capture($event)">
						</app-scanner>
					</div>


					<div *ngIf="documents.length>0" style="text-align: left;font-size: small;margin-top: 20px;">
						<div style="width:100%;overflow: hidden">
							Documents attachés:<br>
							<div class="mat-subtitle-1 color-accent"
							     *ngFor="let document of documents" style="display: flex;align-items: center;"
							     [title]="document.signature+'\n'+document.url">
								<mat-icon title="Enlever le document" (click)="raz_document(document)">delete</mat-icon>
								<mat-icon title="Voir le document" *ngIf="document.url.length>0" (click)="open_doc(document)">link</mat-icon>
								<span style="margin-left: 5px;font-size: small;">{{document.filename}}</span>
							</div>
						</div>
					</div>

					<br>
					<app-input value_type="text" maxlength="40"
					           *ngIf="documents.length>0"
					           (focusout)="eval_preview()"
					           help="Ce titre est également affiché sur le visuel du NFT"
					           label="Titre du certificat (NFT)" [value]="name" (valueChange)="name=$event">
					</app-input>
					<br>


				</mat-step>

				<mat-step *ngIf="documents.length>0">
					<ng-template matStepLabel>Construire le certificat (NFT)</ng-template>
					<br>
					<app-input label="Nombre d'exemplaires (tirage)"
					           [min]="1" [max]="50" [value]="max_supply"
					           value_type="slider" *ngIf="isSemiFungible()"
					           help="Ce nombre correpond au nombre de parts disponibles" (valueChange)="max_supply=$event">
					</app-input>

					<br>
					<span class="mat-body-1" *ngIf="message_preview.length==0">Sélectionner le visuel qui convient pour le NFT</span>
					<br><br>

					<gallery *ngIf="visuels.length>0"
					         style="width: 320px;height:410px;display: inline-block;"
					         (indexChange)="select_visuel($event)" [thumbHeight]="90"
					         [items]="visuels"></gallery>

					<app-hourglass [message]="message_preview" fontsize="10px"></app-hourglass>
					<br>

					<br>
					<app-upload-file (uploaded)="select_visual($event)"
					                 *ngIf="message_preview.length==0"
					                  width="250px" [zone]="false"
					                 [maxsize]="10000000">
						Changer de visuel
					</app-upload-file>
					<br>

				</mat-step>

				<mat-step *ngIf="documents.length>0">
					<ng-template matStepLabel>Informations complémentaires</ng-template>

					<br><br>
					<app-input value_type="memo" [value]="infos" (valueChange)="infos=$event;save_local()"
					           [cols]="10" [rows]="3" maxlength="200"
					           label="Informations complémaires (texte libre)"
					           help="Informations non confidentielles, ajoutées dans le NFT">
					</app-input>


					<br>
					<mat-checkbox [(ngModel)]="joinDoc" (change)="upload_document()">
						Joindre les documents au NFT
					</mat-checkbox>
					<br><br>
					<app-input label="Dimension du visuel" [min]="150" [max]="600" color_value="white"
					           [value]="nft_size" (valueChange)="nft_size=$event" value_type="slider">
					</app-input>

					<br>


				</mat-step>


				<mat-step *ngIf="documents.length>0 && advanced_mode" >
					<ng-template matStepLabel>Signatures complémentaire</ng-template>

					<div style="width: 100%;display: flex;flex-wrap: wrap;margin-top: 20px;">
						<app-input label="Identifiez vous par"
						           width="200px"
						           *ngIf="documents.length>0" value_field="value"
						           [options]="identity_types"
						           [value]="identity_type"
						           (valueChange)="update_identity($event)">
						</app-input>
						<app-input [label]="identity_type"
						           [value]="identity" width="200px"
						           *ngIf="identity_type?.length>0"
						           (valueChange)="identity=$event">
						</app-input>
					</div>



				</mat-step>

			</mat-vertical-stepper>

			<br>
			<br>

			<br>


			<div *ngIf="documents.length>0 && url_wallet.length==0 && url_explorer.length==0 && network.network.length>0">
				<button mat-raised-button color="primary"
				        *ngIf="this.sel_visuel"
				        [title]="'pour '+price+' '+merchant!.wallet!.unity+' ou '+fiat_price+' '+merchant!.currency"
				        [disabled]="message_preview.length>0"
				        (click)="send('cb')">
					Tokenizer !
				</button>

				<button mat-raised-button (click)="restart()">
					Effacer
				</button>
			</div>

			<div *ngIf="url_explorer.length>0 && url_wallet.length>0" class="mat-body-2">
				<a [href]="url_wallet" target="walletNFluent" style="margin: 10px;">Wallet NFLUENT</a>
				<a [href]="url_gallery" target="Gallery" style="margin: 10px;">Voir le NFT</a><br><br>

				<button mat-raised-button color="primary" (click)="restart(true)">
					Nouveau Certificat
				</button>
			</div>

			<br>

		</div>

		<br>

		<div style="display: inline-block;text-align: center;" *ngIf="message.length==0">
			<app-authent
					*ngIf="show_login"
					size="350px"
					[use_cookie]="false"
					[showWalletConnect]="true"
					[showExtensionWallet]="true"
					style="margin-top: 10px;"
					(cancel)="cancel()"
					[showCancel]="true"
					(disconnect)="disconnect()"
					(invalid)="fail($event)"
					(authent)="login($event)"></app-authent>
		</div>


		<div style="position: absolute;display:block;z-index:10;top:-5px;right:5px;color:#a4a4a4;">
			<button mat-icon-button (click)="show_login=true" *ngIf="!show_login && !user.isConnected()">
				<mat-icon>login</mat-icon>
			</button>

			<button mat-icon-button (click)="user.logout()" *ngIf="user.isConnected()">
				<mat-icon>logout</mat-icon>
			</button>
		</div>

	</div>


	<div *ngIf="network.isDevnet() && collection" class="mat-body-2"
	     style="position: fixed;display: block;right: 5px;bottom: 0px;line-height:90%;opacity: 0.3;text-align: right;font-size: xx-small;">
		Version test<br>
		network: {{network.network}}<br>
		stockage : {{stockage}} / {{stockage_document}}<br>
		Compte: {{miner.address}} / {{collection.id}}
	</div>



</div>
